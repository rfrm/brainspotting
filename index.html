<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Brainspotting</title>
  <style id="theme-style">
    :root {
      --bg-color: #1e1e1e;
      --panel-bg: #121212;
      --text-color: #f0f0f0;
      --border-color: #444;
      --pointer-color: white;
      --marker-color: rgba(200, 200, 255, 0.5);
      --code-bg: #333;
      --code-text: #ffd700;
      --glow-color: #70a5ff;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      font-family: sans-serif;
      flex-direction: column;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }

    #brainspotting-screen {
      width: 80vw;
      height: 60vh;
      background-color: var(--panel-bg);
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      cursor: none;
      margin-bottom: 20px;
    }

    #brainspotting-pointer {
      width: 18px;
      height: 18px;
      background-color: var(--pointer-color);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 0%;
      transform: translate(-50%, -50%);
      transition: left 0.1s linear, top 0.1s linear;
      z-index: 10;
      box-shadow: 0 0 8px var(--glow-color), 0 0 16px var(--glow-color);
    }

    .saved-spot-marker {
      width: 10px;
      height: 10px;
      background-color: var(--marker-color);
      border-radius: 50%;
      position: absolute;
      transform: translate(-50%, -50%);
      z-index: 5;
      pointer-events: none;
    }

    #controls {
      text-align: center;
      color: var(--text-color);
      border: 1px dashed var(--border-color);
      padding: 10px 20px;
      background-color: var(--panel-bg);
      max-width: 80vw;
      transition: background-color 0.3s, color 0.3s;
    }

    #controls h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: var(--glow-color);
    }

    #controls p {
      margin: 5px 0;
      line-height: 1.4;
    }

    code {
      background-color: var(--code-bg);
      padding: 2px 5px;
      border-radius: 3px;
      font-weight: bold;
      font-family: monospace;
      color: var(--code-text);
    }
  </style>
</head>
<body>
  <div id="brainspotting-screen">
    <div id="brainspotting-pointer"></div>
    <div id="saved-indicator" style="display:none; font-weight: bold; position: absolute; bottom: 10px; right: 10px; color: var(--glow-color); background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">
      üëÅÔ∏è Mostrando puntos guardados
    </div>
    <div id="saved-message" style="display:none; font-weight: bold; position: absolute; bottom: 10px; left: 10px; color: var(--glow-color); background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px; font-size: 0.9em;">
      ‚úÖ Punto guardado
    </div>
  </div>

  <div id="config-docs" style="display: flex; justify-content: center; gap: 20px; max-width: 80vw; flex-wrap: wrap;">
    <!-- üß≠ Configuraci√≥n izquierda -->
    <div id="config-panel" style="flex: 1; min-width: 250px; background-color: var(--panel-bg); border: 1px dashed var(--border-color); padding: 15px; border-radius: 8px;">
      <h3 style="margin-top: 0; color: var(--glow-color); text-align: center;">üéõÔ∏è Configuraci√≥n</h3>
      <label for="speed-slider" style="font-size: 14px;">Velocidad del puntero: <span id="speed-value"></span>x</label><br />
      <input type="range" id="speed-slider" min="0.1" max="3" step="0.1" value="1" style="width: 100%;" />
      <br /><br />
      <label for="size-slider" style="font-size: 14px;">Tama√±o del puntero: <span id="size-value"></span>px</label><br />
      <input type="range" id="size-slider" min="5" max="50" step="1" value="18" style="width: 100%;" />
    </div>

    <!-- üìò Documentaci√≥n derecha -->
    <div id="docs-panel" style="flex: 2; min-width: 300px;">
      <div id="controls">
        <h3>üß† Controles del Puntero Brainspotting</h3>
        <p>Presiona <code>R</code> para REANUDAR el escaneo (horizontal o vertical).</p>
        <p><code>Barra espaciadora</code> para DETENER el movimiento.</p>
        <p>Cuando est√© detenido:</p>
        <p style="margin-left: 20px;"><code>V</code> para cambiar al escaneo vertical.</p>
        <p style="margin-left: 20px;"><code>H</code> para volver al escaneo horizontal.</p>
        <p style="margin-left: 20px;"><code>‚Üê</code> / <code>‚Üí</code> para mover a la izquierda/derecha.</p>
        <p style="margin-left: 20px;"><code>‚Üë</code> / <code>‚Üì</code> para mover hacia arriba/abajo.</p>
        <p style="margin-left: 20px;"><code>S</code> para guardar el punto actual en 2D.</p>
        <p><code>A</code> para mostrar/ocultar los puntos guardados.</p>
        <p><code>C</code> para borrar todos los puntos guardados (solo si est√°n visibles).</p>
        <p><code>T</code> para alternar entre tema claro y oscuro.</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let darkMode = true;
      const savedTheme = localStorage.getItem('theme');
      const themeStyle = document.getElementById('theme-style');
      if (savedTheme === 'light') {
        toggleTheme();
      }

      const pointer = document.getElementById('brainspotting-pointer');

      // Velocidad
      const speedSlider = document.getElementById('speed-slider');
      const speedValueLabel = document.getElementById('speed-value');
      const speedKey = 'brainspottingPointerSpeed';
      let pointerSpeed = parseFloat(localStorage.getItem(speedKey)) || 1;
      speedSlider.value = pointerSpeed;
      speedValueLabel.textContent = pointerSpeed.toFixed(1);

      // Tama√±o
      const sizeSlider = document.getElementById('size-slider');
      const sizeValueLabel = document.getElementById('size-value');
      const sizeKey = 'brainspottingPointerSize';
      let pointerSize = parseInt(localStorage.getItem(sizeKey)) || 18;
      sizeSlider.value = pointerSize;
      sizeValueLabel.textContent = pointerSize;
      pointer.style.width = `${pointerSize}px`;
      pointer.style.height = `${pointerSize}px`;

      // Actualizar tama√±o en tiempo real
      sizeSlider.addEventListener('input', () => {
        pointerSize = parseInt(sizeSlider.value);
        localStorage.setItem(sizeKey, pointerSize);
        sizeValueLabel.textContent = pointerSize;
        pointer.style.width = `${pointerSize}px`;
        pointer.style.height = `${pointerSize}px`;
      });

      // Actualizar velocidad en tiempo real
      speedSlider.addEventListener('input', () => {
        pointerSpeed = parseFloat(speedSlider.value);
        localStorage.setItem(speedKey, pointerSpeed);
        speedValueLabel.textContent = pointerSpeed.toFixed(1);
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = setInterval(updatePosition, 50 / pointerSpeed);
        }
      });

      const localStorageKey = 'brainspottingSavedSpots2D';
      let currentXPercent = 0;
      let currentYPercent = 50;
      let directionX = 1;
      let directionY = -1;
      let isMoving = false;
      let isVertical = false;
      let intervalId = null;
      let showingSavedSpots = false;

      pointer.style.top = `${currentYPercent}%`;
      pointer.style.left = `${currentXPercent}%`;

      function updatePosition() {
        if (isVertical) {
          currentYPercent += directionY * (100 / (24000 / 50)) * pointerSpeed;
          if (currentYPercent >= 100) { currentYPercent = 100; directionY = -1; }
          else if (currentYPercent <= 0) { currentYPercent = 0; directionY = 1; }
          pointer.style.top = `${currentYPercent}%`;
        } else {
          currentXPercent += directionX * (100 / (24000 / 50)) * pointerSpeed;
          if (currentXPercent >= 100) { currentXPercent = 100; directionX = -1; }
          else if (currentXPercent <= 0) { currentXPercent = 0; directionX = 1; }
          pointer.style.left = `${currentXPercent}%`;
        }
      }

      function startAutoMove() {
        if (isMoving) return;
        pointer.style.transition = 'none';
        isMoving = true;
        intervalId = setInterval(updatePosition, 50 / pointerSpeed);
      }

      function stopAutoMove() {
        if (!isMoving) return;
        clearInterval(intervalId);
        intervalId = null;
        isMoving = false;
        pointer.style.transition = 'left 0.1s linear, top 0.1s linear';
      }

      function resumeScan() {
        if (isMoving) return;
        startAutoMove();
      }

      function switchToVertical() {
        if (!isMoving) {
          isVertical = true;
          startAutoMove();
        }
      }

      function switchToHorizontal() {
        if (!isMoving) {
          isVertical = false;
          startAutoMove();
        }
      }

      function manualMove(dx, dy) {
        currentXPercent = Math.min(100, Math.max(0, currentXPercent + dx));
        currentYPercent = Math.min(100, Math.max(0, currentYPercent + dy));
        pointer.style.left = `${currentXPercent}%`;
        pointer.style.top = `${currentYPercent}%`;
      }

      function savePosition() {
        if (isMoving) return;
        const position = {
          x: parseFloat(currentXPercent.toFixed(2)),
          y: parseFloat(currentYPercent.toFixed(2))
        };
        let savedSpots = JSON.parse(localStorage.getItem(localStorageKey)) || [];
        savedSpots.push(position);
        localStorage.setItem(localStorageKey, JSON.stringify(savedSpots));

        document.getElementById('saved-message').style.display = 'block';
        setTimeout(() => {
          document.getElementById('saved-message').style.display = 'none';
        }, 3000);
      }

      function toggleSavedSpots() {
        const screen = document.getElementById('brainspotting-screen');
        if (showingSavedSpots) {
          screen.querySelectorAll('.saved-spot-marker').forEach(marker => marker.remove());
          document.getElementById('saved-indicator').style.display = 'none';
          showingSavedSpots = false;
        } else {
          const savedSpots = JSON.parse(localStorage.getItem(localStorageKey)) || [];
          savedSpots.forEach(({ x, y }) => {
            const marker = document.createElement('div');
            marker.className = 'saved-spot-marker';
            marker.style.left = `${x}%`;
            marker.style.top = `${y}%`;
            screen.appendChild(marker);
          });
          document.getElementById('saved-indicator').style.display = 'block';
          showingSavedSpots = true;
        }
      }

      function toggleTheme() {
        const themeStyle = document.getElementById('theme-style');
        const darkMode = localStorage.getItem('theme') !== 'light';
        const nextMode = darkMode ? 'light' : 'dark';
        localStorage.setItem('theme', nextMode);

        if (nextMode === 'dark') {
          themeStyle.innerHTML = themeStyle.innerHTML
            .replace('--bg-color: #ffffff', '--bg-color: #1e1e1e')
            .replace('--panel-bg: #f2f2f2', '--panel-bg: #121212')
            .replace('--text-color: #222', '--text-color: #f0f0f0')
            .replace('--border-color: #ccc', '--border-color: #444')
            .replace('--pointer-color: black', '--pointer-color: white')
            .replace('--marker-color: rgba(50, 50, 255, 0.3)', '--marker-color: rgba(200, 200, 255, 0.5)')
            .replace('--code-bg: #e0e0e0', '--code-bg: #333')
            .replace('--code-text: #004488', '--code-text: #ffd700');
        } else {
          themeStyle.innerHTML = themeStyle.innerHTML
            .replace('--bg-color: #1e1e1e', '--bg-color: #ffffff')
            .replace('--panel-bg: #121212', '--panel-bg: #f2f2f2')
            .replace('--text-color: #f0f0f0', '--text-color: #222')
            .replace('--border-color: #444', '--border-color: #ccc')
            .replace('--pointer-color: white', '--pointer-color: black')
            .replace('--marker-color: rgba(200, 200, 255, 0.5)', '--marker-color: rgba(50, 50, 255, 0.3)')
            .replace('--code-bg: #333', '--code-bg: #e0e0e0')
            .replace('--code-text: #ffd700', '--code-text: #004488');
        }
      }

      document.addEventListener('keydown', (event) => {
        if (event.ctrlKey || event.metaKey || event.altKey) return;
        if (event.code === 'Space') {
          event.preventDefault();
          stopAutoMove();
        } else if (event.key.toLowerCase() === 'r') {
          resumeScan();
        } else if (event.key.toLowerCase() === 'v') {
          switchToVertical();
        } else if (event.key.toLowerCase() === 'h') {
          switchToHorizontal();
        } else if (event.key.toLowerCase() === 't') {
          toggleTheme();
        } else if (event.key.toLowerCase() === 'c' && showingSavedSpots) {
          localStorage.removeItem(localStorageKey);
          toggleSavedSpots();
        } else if (!isMoving) {
          if (event.key === 'ArrowLeft') manualMove(-0.25, 0);
          if (event.key === 'ArrowRight') manualMove(0.25, 0);
          if (event.key === 'ArrowUp') manualMove(0, -0.25);
          if (event.key === 'ArrowDown') manualMove(0, 0.25);
          if (event.key.toLowerCase() === 's') savePosition();
        }

        if (event.key.toLowerCase() === 'a') toggleSavedSpots();
      });
    });
  </script>
</body>
</html>

